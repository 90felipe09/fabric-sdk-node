<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: fabric-client: How to use the endorsement and commit handlers</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: fabric-client: How to use the endorsement and commit handlers</h1>

    <section>

<header>
    

    <h2>fabric-client: How to use the endorsement and commit handlers</h2>
</header>

<article>
    <p>This tutorial illustrates the use of the handlers by the Hyperledger Fabric Node.js Client as of 1.3.</p>
<p>For more information on:</p>
<ul>
<li>getting started with Hyperledger Fabric see
<a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building your first network</a>.</li>
<li>the configuration of a channel in Hyperledger Fabric and the internal
process of creating and updating see
<a href="http://hyperledger-fabric.readthedocs.io/en/latest/configtx.html">Hyperledger Fabric channel configuration</a></li>
<li><a href="https://hyperledger-fabric.readthedocs.io/en/latest/discovery-overview.html">Service Discovery</a></li>
</ul>
<p>The following assumes an understanding of the Hyperledger Fabric network
(orderers and peers),
and of Node application development, including the use of the
Javascript <code>promise</code> and <code>async await</code>.</p>
<h3>Overview</h3>
<p>The fabric-client provides the ability for custom code that will handle the
endorsement process and the submitting of endorsements to the orderer.
There are two plug points defined, one on the <a href="Channel.html#sendTransactionProposal">Channel#sendTransactionProposal</a>
and one on the <a href="Channel.html#sendTransaction">Channel#sendTransaction</a>. The fabric-client will pass
control to the handler to complete the processing. The custom code may
decide to retry, try another end point, or use discovery to complete the
task.</p>
<p>see <a href="tutorial-discovery.html">fabric-client: How to use the discovery service</a> on how the default handlers are
used with discovery.</p>
<h4>Modified API's that will use handlers</h4>
<ul>
<li><code>channel.initialize()</code> - This method has been enhanced to instantiate
instances of the handlers for use by the channel. The method will get the
paths from the system configuration settings to create and initialize them.</li>
<li><code>channel.sendTransactionProposal()</code> - This method has been enhanced to use
an <code>endorsement-handler</code> if one has been instantiated and initialized.</li>
<li><code>channel.sendTransaction()</code> - This method has been enhanced to use
a <code>commit-handler</code> if one has been instantiated and initialized.</li>
</ul>
<h4>New configuration settings</h4>
<ul>
<li><code>endorsement-handler</code> - string - The path to the endorsement handler. Allows for a
custom handler to be used. This handler is used in the
<a href="Channel.html#sendTransactionProposal"><code>sendTransactionProposal()</code></a>
method to determine the target peers and how to send the proposal.
(default 'fabric-client/lib/impl/DiscoveryEndorsementHandler.js')</li>
<li><code>commit-handler</code> - string - The path to the commit handler. Allows for
a custom handler to be used. This handler is used in the
<a href="Channel.html#sendTransaction"><code>sendTransaction()</code></a> method
to determine the orderers and how to send the transaction to be committed.
(default 'fabric-client/lib/impl/BasicCommitHandler.js')</li>
</ul>
<h3>new Endorsement Handler</h3>
<p>The sending of a proposal to be endorsed may be done using custom code. The
fabric-client will use by default the file called <code>DiscoveryEndorsementHandler</code>.
A different endorsement handler may be used by changing the configuration setting
&quot;endorsement-handler&quot; with the <code>setConfigSetting()</code> or placing a new line
in configuration JSON file that application has applied to the fabric-client
configuration. This will instantiate a handler
located at the path provide in the attribute for all channels initialized
after the call.
The default handler was designed to be used with discovery to provided automatic
selection of peers and fail over. When used without discovery the handler will
only send to the peers as defined in the targets parameter without fail over.
The handler may also be changed using the <code>endorsementHandler</code> attribute on the
<code>channel.initialize()</code> request call parameter. This will instantiate a handler
located at the path provide in the attribute just for this channel.</p>
<pre class="prettyprint source"><code>// set value in memory
Client.setConfigSetting('endorsement-handler', '/path/to/the/handler.js');
--or--
// the path to an additional config file
Client.addConfigFile('/path/to/config.json');
// the json file contains the following line
// &quot;endorsement-handler&quot;: &quot;/path/to/the/handler.js&quot;
--or--
const request = {
	...
	endorsementHandler: &quot;/path/to/the/handler.js&quot;,
	...
}
// initialize must be run to use handlers.
channel.initialize(request);
</code></pre>
<p>A endorsement handler should extend the <a href="EndorsementHandler.html">EndorsementHandler</a>. When the
channel is initialized, the channel will read the path setting and create an
instance of the handler for use by the new channel instance.</p>
<h3>new <code>CommitHandler</code></h3>
<p>The sending of the endorsements to be committed may be done using custom code.
The fabric-client will use by default the file called <code>BasicCommitHandler</code>.
The commit handler may be changed by changing the configuration setting
&quot;commit-handler&quot; by doing a <code>setConfigSetting()</code> or placing a new line
in configuration JSON file that application has applied to the fabric-client
configuration.
The default handler was designed to be used with discovery to provided automatic
selection of orderers and fail over. When used without discovery the handler will
still provide fail over to all orderers assigned to the channel, sending to
each one in orderer until an orderer response successfully to the transaction
submission.
The handler may also be changed using the <code>commitHandler</code> attribute on the
<code>channel.initialize()</code> request call parameter. This will instantiate a handler
located at the path provide in the attribute just for this channel.</p>
<pre class="prettyprint source"><code>// set the config value in memory
Client.setConfigSetting('commit-handler', '/path/to/the/handler.js');
--or--
// path of an additional config file
Client.addConfigFile('/path/to/config.json');
// the json file contains the following line
// &quot;commit-handler&quot;: &quot;/path/to/the/handler.js&quot;
--or--
const request = {
	...
	commitHandler: &quot;/path/to/the/handler.js&quot;,
	...
}
// initialize must be run to use handlers.
channel.initialize(request);
</code></pre>
<p>A commit handler should extend the <a href="CommitHandler.html">CommitHandler</a>. When the
channel is initialized, the channel will read the path setting and create an
instance of the handler for use by the new channel instance.</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-fabric-network.html">fabric-network</a></li></ul><h3>Classes</h3><ul><li><a href="AffiliationService.html">AffiliationService</a></li><li><a href="BasePackager.html">BasePackager</a></li><li><a href="BasicCommitHandler.html">BasicCommitHandler</a></li><li><a href="BlockDecoder.html">BlockDecoder</a></li><li><a href="CertificateAuthority.html">CertificateAuthority</a></li><li><a href="Chaincode.html">Chaincode</a></li><li><a href="ChaincodeRegistration.html">ChaincodeRegistration</a></li><li><a href="Channel.html">Channel</a></li><li><a href="ChannelEventHub.html">ChannelEventHub</a></li><li><a href="ChannelPeer.html">ChannelPeer</a></li><li><a href="Client.html">Client</a></li><li><a href="CommitHandler.html">CommitHandler</a></li><li><a href="DiscoveryEndorsementHandler.html">DiscoveryEndorsementHandler</a></li><li><a href="EndorsementHandler.html">EndorsementHandler</a></li><li><a href="EndorsementPolicy.html">EndorsementPolicy</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="event_hub_number.html">event_hub_number</a></li><li><a href="FabricCAClient.html">FabricCAClient</a></li><li><a href="FabricCAServices.html">FabricCAServices</a></li><li><a href="IdentityService.html">IdentityService</a></li><li><a href="module-fabric-network.AbstractEventHubSelectionStrategy.html">AbstractEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.AbstractEventListener.html">AbstractEventListener</a></li><li><a href="module-fabric-network.BaseCheckpointer.html">BaseCheckpointer</a></li><li><a href="module-fabric-network.CommitEventListener.html">CommitEventListener</a></li><li><a href="module-fabric-network.Contract.html">Contract</a></li><li><a href="module-fabric-network.ContractEventListener.html">ContractEventListener</a></li><li><a href="module-fabric-network.EventHubDisconnectError.html">EventHubDisconnectError</a></li><li><a href="module-fabric-network.EventHubManager.html">EventHubManager</a></li><li><a href="module-fabric-network.FabricError.html">FabricError</a></li><li><a href="module-fabric-network.FileSystemCheckpointer.html">FileSystemCheckpointer</a></li><li><a href="module-fabric-network.Gateway.html">Gateway</a></li><li><a href="module-fabric-network.HsmX509Provider.html">HsmX509Provider</a></li><li><a href="module-fabric-network.IdentityProviderRegistry.html">IdentityProviderRegistry</a></li><li><a href="module-fabric-network.Network.html">Network</a></li><li><a href="module-fabric-network.Query.html">Query</a></li><li><a href="module-fabric-network.RoundRobinEventHubSelectionStrategy.html">RoundRobinEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.TimeoutError.html">TimeoutError</a></li><li><a href="module-fabric-network.Transaction.html">Transaction</a></li><li><a href="module-fabric-network.Wallet.html">Wallet</a></li><li><a href="module-fabric-network.Wallets.html">Wallets</a></li><li><a href="MSP.html">MSP</a></li><li><a href="MSPManager.html">MSPManager</a></li><li><a href="NetworkConfig_1_0.html">NetworkConfig_1_0</a></li><li><a href="Orderer.html">Orderer</a></li><li><a href="Organization.html">Organization</a></li><li><a href="Peer.html">Peer</a></li><li><a href="Remote.html">Remote</a></li><li><a href="TransactionID.html">TransactionID</a></li></ul><h3>Interfaces</h3><ul><li><a href="module-fabric-network.WalletStore.html">WalletStore</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-app-dev-env-setup.html">Setting up the Application Developer's Environment</a></li><li><a href="tutorial-chaincode-lifecycle.html">fabric-client: How to install and start your chaincode</a></li><li><a href="tutorial-channel-create.html">fabric-client: How to create a Hyperledger Fabric channel</a></li><li><a href="tutorial-channel-events.html">fabric-client: How to use the channel-based event service</a></li><li><a href="tutorial-discovery.html">fabric-client: How to use the discovery service</a></li><li><a href="tutorial-event-checkpointer.html">fabric-network: How to replay missed events</a></li><li><a href="tutorial-event-hub-management.html">fabric-network: How to automatically select and reconnect to event hubs</a></li><li><a href="tutorial-grpc-settings.html">fabric-client: How to set gRPC settings</a></li><li><a href="tutorial-handlers.html">fabric-client: How to use the endorsement and commit handlers</a></li><li><a href="tutorial-listening-to-events.html">fabric-network: How to listen to events</a></li><li><a href="tutorial-logging.html">fabric-client: How to use logging</a></li><li><a href="tutorial-metadata-chaincode.html">fabric-client: How to add CouchDB indexes during chaincode installation</a></li><li><a href="tutorial-mutual-tls.html">fabric-client: How to configure mutual TLS</a></li><li><a href="tutorial-network-config.html">fabric-client: How to use a common connection profile</a></li><li><a href="tutorial-private-data.html">How to use private data</a></li><li><a href="tutorial-query-peers.html">fabric-network: How to select peers for evaluating transactions (queries)</a></li><li><a href="tutorial-sign-transaction-offline.html">Working with an offline private key</a></li><li><a href="tutorial-transaction-commit-events.html">fabric-network: How to wait for transactions to be committed to the ledger</a></li><li><a href="tutorial-wallet.html">fabric-network: Using wallets to manage identities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CLIENT">CLIENT</a></li><li><a href="global.html#finalPackage">finalPackage</a></li><li><a href="global.html#HFAFFILIATIONMGR">HFAFFILIATIONMGR</a></li><li><a href="global.html#HFGENCRL">HFGENCRL</a></li><li><a href="global.html#HFINTERMEDIATECA">HFINTERMEDIATECA</a></li><li><a href="global.html#HFREGISTRARATTRIBUTES">HFREGISTRARATTRIBUTES</a></li><li><a href="global.html#HFREGISTRARDELEGATEROLES">HFREGISTRARDELEGATEROLES</a></li><li><a href="global.html#HFREGISTRARROLES">HFREGISTRARROLES</a></li><li><a href="global.html#HFREVOKER">HFREVOKER</a></li><li><a href="global.html#loadConfigGroup">loadConfigGroup</a></li><li><a href="global.html#loadConfigValue">loadConfigValue</a></li><li><a href="global.html#ORDERER">ORDERER</a></li><li><a href="global.html#package">package</a></li><li><a href="global.html#PEER">PEER</a></li><li><a href="global.html#toEnvelope">toEnvelope</a></li><li><a href="global.html#USER">USER</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Dec 23 2019 09:48:57 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>