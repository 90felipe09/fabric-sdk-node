<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: fabric-network: How to wait for transactions to be committed to the ledger</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: fabric-network: How to wait for transactions to be committed to the ledger</h1>

    <section>

<header>
    

    <h2>fabric-network: How to wait for transactions to be committed to the ledger</h2>
</header>

<article>
    <p>This tutorial describes the approaches that can be selected by users of the
fabric-network module for ensuring that submitted transactions are committed
on peers.</p>
<h3>Overview</h3>
<p>The submit of a transaction involves several steps:</p>
<ol>
<li>Send proposals to endorsing peers.</li>
<li>Send the endorsed transaction to the orderer.</li>
<li>The transaction is <em>eventually</em> committed on all peers in the network.</li>
</ol>
<p>In some cases a client application might be happy to proceed immediately after
the transaction is successfully sent to the orderer. In other cases a client
application might need to ensure that the transaction has been committed on
certain peers with which it wants to interact before proceeding.</p>
<p>It is important to note that the blockchain state visible from a specific peer
will remain unchanged until a transaction is committed on that peer. If a
client application queries a peer for state after an endorsed transaction has
been successfully sent to the orderer but before the transaction has been
committed on that peer, the state returned will still be that prior to the
transaction. For example, a query of a bank balance after a transaction to
deduct funds from that bank account is submitted to the orderer will return
the old balance until the transaction is eventually committed on the peer
being queried.</p>
<h3>Event handling strategies</h3>
<p>The SDK provides several selectable strategies for how it should wait for
commit events following a transaction invocation. The available strategies
are defined in <code>DefaultEventHandlerStrategies</code>. The desired strategy is
(optionally) specified as an argument to <code>connect()</code> on the <code>Gateway</code>, and
is used for all transaction invocations on Contracts obtained from that
Gateway instance.</p>
<p>If no event handling strategy is specified, <code>MSPID_SCOPE_ALLFORTX</code> is used
by default.</p>
<pre class="prettyprint source lang-javascript"><code>const { Gateway, DefaultEventHandlerStrategies } = require('fabric-network');

const connectOptions = {
    eventHandlerOptions: {
        strategy: DefaultEventHandlerStrategies.MSPID_SCOPE_ALLFORTX
    }
}

const gateway = new Gateway();
await gateway.connect(connectionProfile, connectOptions);
</code></pre>
<p>Specifying <code>null</code> as the event handling strategy will cause transaction
invocations to return immediately after successfully sending the endorsed
transaction to the orderer. It will not wait for any commit events to be
received from peers.  For more details on <em>Event Handling Options</em>, see <a href="module-fabric-network.Gateway.html#~DefaultEventHandlerOptions__anchor">DefaultEventHandlerOptions</a>.</p>
<h3>Plug-in event handlers</h3>
<p>If behavior is required that is not provided by the default event handling
strategies, it is possible to implement your own event handling. This is
achieved by specifying your own factory function as the event handling
strategy. The factory function should return a <em>transaction event handler</em>
object and take two parameters:</p>
<ol>
<li>Transaction:  <code>Transaction</code></li>
<li>Blockchain network: <code>Network</code></li>
</ol>
<p>The Network provides access to peers and event hubs from which events should
be recieved.</p>
<pre class="prettyprint source lang-javascript"><code>function createTransactionEventHandler(transaction, network) {
    /* Your implementation here */
    return new MyTransactionEventHandler(transaction, eventHubs);
}

const connectOptions = {
    eventHandlerOptions: {
        strategy: createTransactionEventhandler
    }
 }

const gateway = new Gateway();
await gateway.connect(connectionProfile, connectOptions);
</code></pre>
<p>For more details on <em>Event Handling Options</em>, see <a href="module-fabric-network.Gateway.html#~DefaultEventHandlerOptions__anchor">DefaultEventHandlerOptions</a>.</p>
<p>The <em>transaction event handler</em> object returned must implement the following
lifecycle functions.</p>
<pre class="prettyprint source lang-javascript"><code>class MyTransactionEventHandler {
    /**
     * Called to initiate listening for transaction events.
     * @async
     * @throws {Error} if not in a state where the handling strategy can be satified and the transaction should
     * be aborted. For example, if insufficient event hubs are available.
     */
    async startListening() { /* Your implementation here */ }

    /**
     * Wait until enough events have been received from the event hubs to satisfy the event handling strategy.
     * @async
     * @throws {Error} if the transaction commit is not successfully confirmed.
     */
    async waitForEvents() { /* Your implementation here */ }

    /**
     * Cancel listening for events.
     */
    cancelListening() { /* Your imeplementation here */ }
}
</code></pre>
<p>For a complete sample plug-in event handler implementation, see <a href="https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/network-e2e/sample-transaction-event-handler.js">sample-transaction-event-handler.js</a>.</p>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-fabric-network.html">fabric-network</a></li></ul><h3>Classes</h3><ul><li><a href="AffiliationService.html">AffiliationService</a></li><li><a href="BasePackager.html">BasePackager</a></li><li><a href="BasicCommitHandler.html">BasicCommitHandler</a></li><li><a href="BlockDecoder.html">BlockDecoder</a></li><li><a href="CertificateAuthority.html">CertificateAuthority</a></li><li><a href="Chaincode.html">Chaincode</a></li><li><a href="ChaincodeRegistration.html">ChaincodeRegistration</a></li><li><a href="Channel.html">Channel</a></li><li><a href="ChannelEventHub.html">ChannelEventHub</a></li><li><a href="ChannelPeer.html">ChannelPeer</a></li><li><a href="Client.html">Client</a></li><li><a href="CommitHandler.html">CommitHandler</a></li><li><a href="DiscoveryEndorsementHandler.html">DiscoveryEndorsementHandler</a></li><li><a href="EndorsementHandler.html">EndorsementHandler</a></li><li><a href="EndorsementPolicy.html">EndorsementPolicy</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="event_hub_number.html">event_hub_number</a></li><li><a href="FabricCAClient.html">FabricCAClient</a></li><li><a href="FabricCAServices.html">FabricCAServices</a></li><li><a href="IdentityService.html">IdentityService</a></li><li><a href="module-fabric-network.AbstractEventHubSelectionStrategy.html">AbstractEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.AbstractEventListener.html">AbstractEventListener</a></li><li><a href="module-fabric-network.BaseCheckpointer.html">BaseCheckpointer</a></li><li><a href="module-fabric-network.CommitEventListener.html">CommitEventListener</a></li><li><a href="module-fabric-network.Contract.html">Contract</a></li><li><a href="module-fabric-network.ContractEventListener.html">ContractEventListener</a></li><li><a href="module-fabric-network.EventHubDisconnectError.html">EventHubDisconnectError</a></li><li><a href="module-fabric-network.EventHubManager.html">EventHubManager</a></li><li><a href="module-fabric-network.FabricError.html">FabricError</a></li><li><a href="module-fabric-network.FileSystemCheckpointer.html">FileSystemCheckpointer</a></li><li><a href="module-fabric-network.Gateway.html">Gateway</a></li><li><a href="module-fabric-network.HsmX509Provider.html">HsmX509Provider</a></li><li><a href="module-fabric-network.IdentityProviderRegistry.html">IdentityProviderRegistry</a></li><li><a href="module-fabric-network.Network.html">Network</a></li><li><a href="module-fabric-network.Query.html">Query</a></li><li><a href="module-fabric-network.RoundRobinEventHubSelectionStrategy.html">RoundRobinEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.TimeoutError.html">TimeoutError</a></li><li><a href="module-fabric-network.Transaction.html">Transaction</a></li><li><a href="module-fabric-network.Wallet.html">Wallet</a></li><li><a href="module-fabric-network.Wallets.html">Wallets</a></li><li><a href="MSP.html">MSP</a></li><li><a href="MSPManager.html">MSPManager</a></li><li><a href="NetworkConfig_1_0.html">NetworkConfig_1_0</a></li><li><a href="Orderer.html">Orderer</a></li><li><a href="Organization.html">Organization</a></li><li><a href="Peer.html">Peer</a></li><li><a href="Remote.html">Remote</a></li><li><a href="TransactionID.html">TransactionID</a></li></ul><h3>Interfaces</h3><ul><li><a href="module-fabric-network.WalletStore.html">WalletStore</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-app-dev-env-setup.html">Setting up the Application Developer's Environment</a></li><li><a href="tutorial-chaincode-lifecycle.html">fabric-client: How to install and start your chaincode</a></li><li><a href="tutorial-channel-create.html">fabric-client: How to create a Hyperledger Fabric channel</a></li><li><a href="tutorial-channel-events.html">fabric-client: How to use the channel-based event service</a></li><li><a href="tutorial-discovery.html">fabric-client: How to use the discovery service</a></li><li><a href="tutorial-event-checkpointer.html">fabric-network: How to replay missed events</a></li><li><a href="tutorial-event-hub-management.html">fabric-network: How to automatically select and reconnect to event hubs</a></li><li><a href="tutorial-grpc-settings.html">fabric-client: How to set gRPC settings</a></li><li><a href="tutorial-handlers.html">fabric-client: How to use the endorsement and commit handlers</a></li><li><a href="tutorial-listening-to-events.html">fabric-network: How to listen to events</a></li><li><a href="tutorial-logging.html">fabric-client: How to use logging</a></li><li><a href="tutorial-metadata-chaincode.html">fabric-client: How to add CouchDB indexes during chaincode installation</a></li><li><a href="tutorial-mutual-tls.html">fabric-client: How to configure mutual TLS</a></li><li><a href="tutorial-network-config.html">fabric-client: How to use a common connection profile</a></li><li><a href="tutorial-private-data.html">How to use private data</a></li><li><a href="tutorial-query-peers.html">fabric-network: How to select peers for evaluating transactions (queries)</a></li><li><a href="tutorial-sign-transaction-offline.html">Working with an offline private key</a></li><li><a href="tutorial-transaction-commit-events.html">fabric-network: How to wait for transactions to be committed to the ledger</a></li><li><a href="tutorial-wallet.html">fabric-network: Using wallets to manage identities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CLIENT">CLIENT</a></li><li><a href="global.html#finalPackage">finalPackage</a></li><li><a href="global.html#HFAFFILIATIONMGR">HFAFFILIATIONMGR</a></li><li><a href="global.html#HFGENCRL">HFGENCRL</a></li><li><a href="global.html#HFINTERMEDIATECA">HFINTERMEDIATECA</a></li><li><a href="global.html#HFREGISTRARATTRIBUTES">HFREGISTRARATTRIBUTES</a></li><li><a href="global.html#HFREGISTRARDELEGATEROLES">HFREGISTRARDELEGATEROLES</a></li><li><a href="global.html#HFREGISTRARROLES">HFREGISTRARROLES</a></li><li><a href="global.html#HFREVOKER">HFREVOKER</a></li><li><a href="global.html#loadConfigGroup">loadConfigGroup</a></li><li><a href="global.html#loadConfigValue">loadConfigValue</a></li><li><a href="global.html#ORDERER">ORDERER</a></li><li><a href="global.html#package">package</a></li><li><a href="global.html#PEER">PEER</a></li><li><a href="global.html#toEnvelope">toEnvelope</a></li><li><a href="global.html#USER">USER</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Thu Dec 19 2019 11:44:33 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>